<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Project DB by robert-mcdermott</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Project DB</h1>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2>
<a id="postgressql-container-mangement-for-dbaas" class="anchor" href="#postgressql-container-mangement-for-dbaas" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PostgresSQL Container Mangement for DBaaS</h2>

<h3>
<a id="command-line-documentation" class="anchor" href="#command-line-documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Command Line Documentation</h3>

<h4>
<a id="creating-new-databases" class="anchor" href="#creating-new-databases" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating New Databases</h4>

<p>To create a new database container use the postgres_create.py script as follows:</p>

<pre><code> ./postgres_create.py --help
Usage: postgres_create.py --name=&lt;container/dbname&gt; --dbuser=&lt;username&gt; --password=&lt;password&gt; --owner=&lt;owner&gt; --description='&lt;description&gt;' [--memlimit=&lt;num&gt;&lt;m/g&gt; (optional)]

Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -n NAME, --name=NAME  Set the name of the container and database
  -u DBUSER, --dbuser=DBUSER
                        Set the database username
  -p PASSWD, --password=PASSWD
                        Set the dbuser's password
  -o OWNER, --owner=OWNER
                        Set the owner of the container/db
  -c CONTACT, --contact=CONTACT
                        Set database contact (email)
  -d DESCRIPTION, --description=DESCRIPTION
                        Set the descriptoin of the container/db
  -m MEMLIMIT, --memlimit=MEMLIMIT
                        Set the maximum RAM that the containter can use.
                        Specify "m" for MB and "g" for GB - ex: 512m, 2g
                        (optional) - defaults to 2g if no limit provided

</code></pre>

<p>For example, to create a PostgresSQL 9.5 database container with the following attributes:</p>

<ul>
<li>
<strong>Container name / DB Name:</strong>  scicomp_demo</li>
<li>
<strong>DB username:</strong> scicomp</li>
<li>
<strong>DB password:</strong> demopassword01</li>
<li>
<strong>Owner:</strong> ad/scicomp</li>
<li>
<strong>Contact:</strong> <a href="mailto:rmcdermo@fredhutch.org">rmcdermo@fredhutch.org</a>
</li>
<li>
<strong>Description:</strong> "Demo DB for scicomp"</li>
<li>
<strong>Mem limit:</strong> 768MB of RAM</li>
</ul>

<p>You would use the following command:</p>

<pre><code>./postgres_create.py --name scicomp_demo \
                     --dbuser scicomp \
                     --password demopassword01 \
                     --owner ad/scicomp \
                     --contact rmcdermo@fredhutch.org \
                     --description "Demo DB for SciComp" \
                     --memlimit 768m
</code></pre>

<p>The output of the command confirming that the DB was created would look like the following:</p>

<pre><code>CONTAINER ID        NAMES               PORTS                     STATUS
288453e3c82a        scicomp_demo        0.0.0.0:32792-&gt;5432/tcp   Up Less than a second
</code></pre>

<p>The above output means that the database container was sucessfully created and is listing on TCP port 32792 on the DBaaS host for client connections.</p>

<h4>
<a id="listing-the-dbaas-containers" class="anchor" href="#listing-the-dbaas-containers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Listing the DBaaS Containers</h4>

<p>To see a list of all the DBaaS containers running with the details of the containers, run the following command:</p>

<pre><code>./postgres_list.py
</code></pre>

<p>The output of the above command should look something like the following:</p>

<pre><code>container_name  container_id  db_name         username   port   mem_limit size       owner           contact                   status
maxquant4       9b6e30304b28  maxquant4       maxquant   32812  2048MB    2.5MB      vi/paulovich_a  clin@fredhutch.org        Up 3 hours
maxquant3       24ed1a9200e7  maxquant3       maxquant   32811  2048MB    600KB      vi/paulovich_a  clin@fredhutch.org        Up 3 hours
maxquant2       32922e049ce5  maxquant2       maxquant   32810  768MB     63MB       vi/paulovich_a  clin@fredhutch.org        Up 4 hours
maxquant        389a1941130f  maxquant        maxquant   32804  768MB     1.3MB      vi/paulovich_a  clin@fredhutch.org        Up 4 hours
jimmy           87795f7b365d  jimmy           maxquant   32803  768MB     117.4MB    vi/paulovich_a  clin@fredhutch.org        Up 4 hours
scicomp_demo    288453e3c82a  scicomp_demo    scicomp    32792  None      5.33GB     ad/scicomp      rmcdermo@fredhutch.org    Up 28 hours
demodb01        18d67e487b68  demodb01        demouser   32791  None      63GB       None            demo@fredhutch.org        Up 29 hours
trump_db        18eb91dfc2de  trump_db        trump      32790  None      17.75MB    tt/trump        trump@trump.com           Up 29 hours
turdblossom     a3bc3dadbf6c  turdblossom     turd       32789  None      254.54MB   cr/turd         turd@fredhutch.com        Up 29 hours
cpas            6a706cbec97b  cpas            cpas       32787  None      563MB      sr/proteomics   gafking@fredhutch.org     Up 30 hours
it_budget       1ce047c36987  it_budget       budget     32786  None      639MB      ad/finance      mrmoney@fredhutch.org     Up 30 hours
genomic_stuff   d65b81b75e37  genomic_stuff   genoics    32785  None      989KB      sr/genomic      jdelrow@fredhutch.org     Up 30 hours
oncoscape_brain 58972326c5c6  oncoscape_brain oncoscape  32784  None      777KB      hb/sttr         rmcdermo@fredhutch.org    Up 30 hours
testlabel       01940f0c27e6  testlabel       test       32783  None      17.55MB    ad/scicomp      rmcdermo@fredhutch.org    Up 30 hours
</code></pre>

<h4>
<a id="database-backups" class="anchor" href="#database-backups" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Database Backups</h4>

<p>To backup all running DBaaS postgres database containers and send the backups to the cloud (S3 bucket), run the following command on your DBaaS host:</p>

<pre><code>./postgres_backup.py
</code></pre>

<p>The above command will perform a DB dump of all running database containers and place the backups in '/var/db-backups'. In addition to local backups, this will also send the backups to and AWS S3 stoage bucket at s3://fredhutch-postgres-backups. The output of this command will look like this:</p>

<pre><code>DBaaS Backups for Thu Mar  3 16:28:32 2016
--------------------------------------------------
Dumping  scicomp_demo DB (/var/db-backups//scicomp_demo_2016-03-03_16-28-32.sql)
Dumping  demodb01 DB (/var/db-backups//demodb01_2016-03-03_16-28-32.sql)
Dumping  trump_db DB (/var/db-backups//trump_db_2016-03-03_16-28-32.sql)
Dumping  turdblossom DB (/var/db-backups//turdblossom_2016-03-03_16-28-32.sql)
Dumping  cpas DB (/var/db-backups//cpas_2016-03-03_16-28-32.sql)
Dumping  it_budget DB (/var/db-backups//it_budget_2016-03-03_16-28-32.sql)
Dumping  genomic_stuff DB (/var/db-backups//genomic_stuff_2016-03-03_16-28-32.sql)
Dumping  oncoscape_brain DB (/var/db-backups//oncoscape_brain_2016-03-03_16-28-32.sql)
Dumping  testlabel DB (/var/db-backups//testlabel_2016-03-03_16-28-32.sql)

Sending backups to the Cloud (s3://fredhutch-postgres-backups)
--------------------------------------------------
/var/db-backups/trump_db_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/trump_db_2016-03-03_16-28-32.sql
/var/db-backups/testlabel_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/testlabel_2016-03-03_16-28-32.sql
/var/db-backups/turdblossom_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/turdblossom_2016-03-03_16-28-32.sql
/var/db-backups/scicomp_demo_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/scicomp_demo_2016-03-03_16-28-32.sql
/var/db-backups/it_budget_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/it_budget_2016-03-03_16-28-32.sql
/var/db-backups/cpas_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/cpas_2016-03-03_16-28-32.sql
/var/db-backups/genomic_stuff_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/genomic_stuff_2016-03-03_16-28-32.sql
/var/db-backups/oncoscape_brain_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/oncoscape_brain_2016-03-03_16-28-32.sql
/var/db-backups/demodb01_2016-03-03_16-28-32.sql --&gt; s3://fredhutch-postgres-backups/demodb01_2016-03-03_16-28-32.sql
</code></pre>

<h3>
<a id="web-interface" class="anchor" href="#web-interface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Web Interface</h3>

<p>A very basic web console if provided. To run it you'll need Python 2.7 and Flask installed (apt-get install -y python-flask). To run the web console just execute the "webui.py" script and point a web browser at "http://servername:1776" (replace "servername" with the name of the system were you are running the script.</p>

<p>If everything is working, you'll be presended with the following web page:</p>

<p><img src="../roberts_branch/images/index.png?raw=true" alt="index"></p>

<p>To get a list of the current database conatiners running on the system, click on the "List Database Containers" link, which should result in something similar to the following:</p>

<p><img src="../roberts_branch/images/list.png?raw=true" alt="list"></p>

<p>To create a new database container, click on the "Create a Database Container" link, which will present you with a form similar to the following:</p>

<p><img src="../roberts_branch/images/create.png?raw=true" alt="create"></p>

<p>Fill out the form <strong>completely</strong> and click "Submit" which will result in a page similar to the following being displayed:</p>

<p><img src="../roberts_branch/images/created.png?raw=true" alt="created"></p>

<p>To view an inventory of database backup archives that are currently backed up to Amazon S3, click on the "List Database Backup Archives" link. This will provide you will a backup inventory similar to the page shown below:</p>

<p><img src="../roberts_branch/images/backups.png?raw=true" alt="backups"></p>
        </section>
      </div>
    </div>

  
  </body>
</html>
